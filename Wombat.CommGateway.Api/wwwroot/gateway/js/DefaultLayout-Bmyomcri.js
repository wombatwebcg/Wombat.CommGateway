import{d as e,r as a,p as l,q as o,w as t,g as s,e as d,n as u,t as n,b as r,j as i,s as c,E as m,v as p,i as f,c as _,x as v,y as w,k as h,F as g,z as V,A as b,B as P,T as y,C as x,K as k,D as C,h as U}from"./index-BKaj1bP9.js";import{_ as B}from"./logo-D0IE-A81.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as j}from"./dataCollection-CnmYLUmi.js";const E={class:"dialog-footer"},T=I(e({__name:"UserProfile",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:p}){const f=e,_=p,v=a(f.modelValue),w=a({username:"",role:"",phone:"",email:""});l((()=>f.modelValue),(async e=>{v.value=e,e&&await g()})),l(v,(e=>{_("update:modelValue",e)}));const h=()=>{v.value=!1},g=async()=>{try{const e=await c.get("/api/permissions/user-info");w.value=e}catch(e){m.error(e.message||"获取用户信息失败")}};return(e,a)=>{const l=s("el-descriptions-item"),c=s("el-descriptions"),m=s("el-button"),p=s("el-dialog");return i(),o(p,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),title:"个人信息",width:"500px","close-on-click-modal":!1,onClose:h},{footer:t((()=>[r("span",E,[d(m,{onClick:a[0]||(a[0]=e=>v.value=!1)},{default:t((()=>a[2]||(a[2]=[u("关闭")]))),_:1,__:[2]})])])),default:t((()=>[d(c,{column:1,border:""},{default:t((()=>[d(l,{label:"用户名"},{default:t((()=>[u(n(w.value.username),1)])),_:1}),d(l,{label:"角色"},{default:t((()=>[u(n(w.value.role),1)])),_:1}),d(l,{label:"联系方式"},{default:t((()=>[u(n(w.value.phone),1)])),_:1}),d(l,{label:"邮箱"},{default:t((()=>[u(n(w.value.email),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-09b48787"]]),q={class:"dialog-footer"},F=I(e({__name:"ChangePassword",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:n}){const p=e,f=n,_=a(p.modelValue),v=a(),w=a({oldPassword:"",newPassword:"",confirmPassword:""}),h=a({oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,validator:(e,a,l)=>{var o;""===a?l(new Error("请输入密码")):(""!==w.value.confirmPassword&&(null==(o=v.value)||o.validateField("confirmPassword")),l())},trigger:"blur"}],confirmPassword:[{required:!0,validator:(e,a,l)=>{""===a?l(new Error("请再次输入密码")):a!==w.value.newPassword?l(new Error("两次输入密码不一致!")):l()},trigger:"blur"}]});l((()=>p.modelValue),(e=>{_.value=e})),l(_,(e=>{f("update:modelValue",e)}));const g=()=>{var e;_.value=!1,w.value={oldPassword:"",newPassword:"",confirmPassword:""},null==(e=v.value)||e.resetFields()},V=async()=>{v.value&&await v.value.validate((async(e,a)=>{if(e)try{await c.post("/api/permissions/change-password",{oldPassword:w.value.oldPassword,newPassword:w.value.newPassword}),m.success("密码修改成功"),g()}catch(l){m.error(l.message||"密码修改失败")}}))};return(e,a)=>{const l=s("el-input"),n=s("el-form-item"),c=s("el-form"),m=s("el-button"),p=s("el-dialog");return i(),o(p,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=e=>_.value=e),title:"修改密码",width:"500px","close-on-click-modal":!1,onClose:g},{footer:t((()=>[r("span",q,[d(m,{onClick:a[3]||(a[3]=e=>_.value=!1)},{default:t((()=>a[5]||(a[5]=[u("取消")]))),_:1,__:[5]}),d(m,{type:"primary",onClick:V},{default:t((()=>a[6]||(a[6]=[u("确定")]))),_:1,__:[6]})])])),default:t((()=>[d(c,{ref_key:"formRef",ref:v,model:w.value,rules:h.value,"label-width":"100px","status-icon":""},{default:t((()=>[d(n,{label:"原密码",prop:"oldPassword"},{default:t((()=>[d(l,{modelValue:w.value.oldPassword,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value.oldPassword=e),type:"password","show-password":"",placeholder:"请输入原密码"},null,8,["modelValue"])])),_:1}),d(n,{label:"新密码",prop:"newPassword"},{default:t((()=>[d(l,{modelValue:w.value.newPassword,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value.newPassword=e),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])])),_:1}),d(n,{label:"确认密码",prop:"confirmPassword"},{default:t((()=>[d(l,{modelValue:w.value.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>w.value.confirmPassword=e),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-05d1bf98"]]),z={class:"default-layout-wrapper"},D={class:"logo"},L={class:"header-left"},S={class:"header-right"},A={class:"user-info"},K=I(e({__name:"DefaultLayout",setup(e){const l=f(),c=U(),I=a(!1),E=a(""),q=a(!1),K=p((()=>{const e=[];if(e.push({title:"工业网关",path:"/config"}),l.matched.length>1){const a=l.matched[1];if(a&&a.meta.title&&e.push({title:a.meta.title,path:a.path}),l.matched.length>2){const a=l.matched[2];a&&a.meta.title&&e.push({title:a.meta.title,path:a.path})}}return e})),M=a(!1),R=a(!1),$=a({username:"管理员",role:"超级管理员",phone:"138****8888"}),G=()=>{C.confirm("确定要重启网关吗？重启过程中系统将暂时不可用。","重启确认",{confirmButtonText:"确定重启",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then((async()=>{q.value=!0;try{await j(),m.success("网关重启成功")}catch(e){m.error("网关重启失败，请稍后重试")}finally{q.value=!1}})).catch((()=>{}))},H=e=>{switch(e){case"profile":M.value=!0;break;case"changePwd":R.value=!0;break;case"logout":C.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{localStorage.removeItem("token"),c.push("/login")})).catch((()=>{}))}};return(e,a)=>{const c=s("Setting"),m=s("el-icon"),p=s("el-menu-item"),f=s("el-sub-menu"),C=s("Monitor"),U=s("el-menu"),j=s("el-aside"),J=s("Fold"),N=s("Expand"),O=s("el-breadcrumb-item"),Q=s("el-breadcrumb"),W=s("el-input"),X=s("el-button"),Y=s("el-avatar"),Z=s("el-dropdown-item"),ee=s("el-dropdown-menu"),ae=s("el-dropdown"),le=s("el-header"),oe=s("router-view"),te=s("el-main"),se=s("el-container");return i(),_("div",z,[d(se,{class:"layout-container"},{default:t((()=>[d(j,{width:I.value?"80px":"220px",class:"aside"},{default:t((()=>[r("div",D,[a[4]||(a[4]=r("img",{src:B,alt:"Logo"},null,-1)),v(r("span",null,"工业网关",512),[[w,!I.value]])]),d(U,{"default-active":h(l).path,class:"menu",router:!0,collapse:I.value,"collapse-transition":!0,"background-color":"transparent","text-color":"rgba(255, 255, 255, 0.85)","active-text-color":"#ffffff"},{default:t((()=>[d(f,{index:"/config"},{title:t((()=>[d(m,null,{default:t((()=>[d(c)])),_:1}),a[5]||(a[5]=r("span",null,"配置中心",-1))])),default:t((()=>[d(p,{index:"/config/channels"},{default:t((()=>a[6]||(a[6]=[u("通信通道")]))),_:1,__:[6]}),d(p,{index:"/config/devices"},{default:t((()=>a[7]||(a[7]=[u("设备管理")]))),_:1,__:[7]}),d(p,{index:"/config/points"},{default:t((()=>a[8]||(a[8]=[u("点位管理")]))),_:1,__:[8]})])),_:1}),d(p,{index:"/point-monitor"},{title:t((()=>a[9]||(a[9]=[u("点位监视")]))),default:t((()=>[d(m,null,{default:t((()=>[d(C)])),_:1})])),_:1}),d(f,{index:"/log"},{title:t((()=>[d(m,null,{default:t((()=>[d(C)])),_:1}),a[10]||(a[10]=r("span",null,"日志管理",-1))])),default:t((()=>[d(p,{index:"/log"},{default:t((()=>a[11]||(a[11]=[u("日志概览")]))),_:1,__:[11]}),d(p,{index:"/log/system"},{default:t((()=>a[12]||(a[12]=[u("系统日志")]))),_:1,__:[12]}),d(p,{index:"/log/operation"},{default:t((()=>a[13]||(a[13]=[u("操作日志")]))),_:1,__:[13]}),d(p,{index:"/log/communication"},{default:t((()=>a[14]||(a[14]=[u("通信日志")]))),_:1,__:[14]})])),_:1})])),_:1},8,["default-active","collapse"])])),_:1},8,["width"]),d(se,null,{default:t((()=>[d(le,{class:"header"},{default:t((()=>[r("div",L,[d(m,{class:"collapse-btn",onClick:a[0]||(a[0]=e=>I.value=!I.value)},{default:t((()=>[I.value?(i(),o(N,{key:1})):(i(),o(J,{key:0}))])),_:1}),d(Q,{separator:"/"},{default:t((()=>[(i(!0),_(g,null,V(K.value,((e,a)=>(i(),o(O,{key:a,to:e.path},{default:t((()=>[u(n(e.title),1)])),_:2},1032,["to"])))),128))])),_:1})]),r("div",S,[d(W,{modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value=e),placeholder:"搜索...",class:"search-input","prefix-icon":h(b)},null,8,["modelValue","prefix-icon"]),d(X,{type:"warning",icon:h(P),loading:q.value,onClick:G,class:"restart-btn",title:"重启网关"},{default:t((()=>a[15]||(a[15]=[u(" 重启网关 ")]))),_:1,__:[15]},8,["icon","loading"]),d(ae,{onCommand:H},{dropdown:t((()=>[d(ee,null,{default:t((()=>[d(Z,{command:"profile"},{default:t((()=>a[17]||(a[17]=[u("个人信息")]))),_:1,__:[17]}),d(Z,{command:"changePwd"},{default:t((()=>a[18]||(a[18]=[u("修改密码")]))),_:1,__:[18]}),d(Z,{divided:"",command:"logout"},{default:t((()=>a[19]||(a[19]=[u("退出登录")]))),_:1,__:[19]})])),_:1})])),default:t((()=>[r("span",A,[d(Y,{size:32,src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),a[16]||(a[16]=r("span",null,"管理员",-1))])])),_:1})])])),_:1}),d(te,null,{default:t((()=>[d(oe,null,{default:t((({Component:a})=>[d(y,{name:"fade",mode:"out-in"},{default:t((()=>[(i(),o(k,null,[(i(),o(x(a),{key:e.$route.fullPath}))],1024))])),_:2},1024)])),_:1})])),_:1})])),_:1})])),_:1}),d(T,{modelValue:M.value,"onUpdate:modelValue":a[2]||(a[2]=e=>M.value=e),userInfo:$.value},null,8,["modelValue","userInfo"]),d(F,{modelValue:R.value,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value=e)},null,8,["modelValue"])])}}}),[["__scopeId","data-v-c0a46949"]]);export{K as default};
