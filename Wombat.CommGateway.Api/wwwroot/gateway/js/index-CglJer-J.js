import{d as e,r as a,a as l,p as o,o as t,c as n,b as r,e as u,w as i,g as d,E as p,n as c,k as s,G as f,x as m,H as g,q as b,t as v,I as y,F as _,J as h,D as S,j as V}from"./index-Bo2QAGFo.js";import{C as T,P as C,a as N,g as k,u as P,d as U,c as w,b as E}from"./channel-CFr8tcDl.js";import{_ as A}from"./_plugin-vue_export-helper-BCo6x5W8.js";const R={class:"channels-container"},O={class:"page-header"},I={class:"pagination"},M={class:"dialog-footer"},B=A(e({__name:"index",setup(e){const A=a(!1),B=a([]),x=a(1),j=a(10),F=a(0),q=a(!1),z=a("add"),J=a(),D=l({name:"",type:N.Ethernet,protocol:C.ModbusTCP,enable:!0,configuration:{ipAddress:"",port:"502",connectionType:"TCP",cpuType:"S7-1200",rack:"0",slot:"0"},status:1,role:T.Client}),G={name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],type:[{required:!0,message:"请选择通道类型",trigger:"change"}],protocol:[{required:!0,message:"请选择协议类型",trigger:"change"}],role:[{required:!0,message:"请选择通道角色",trigger:"change"}],"configuration.ipAddress":[{required:!0,message:"请输入IP地址",trigger:"blur",validator:(e,a,l)=>{D.type!==N.Ethernet||a?l():l(new Error("请输入IP地址"))}}],"configuration.port":[{required:!0,message:"请输入端口号",trigger:"blur",validator:(e,a,l)=>{D.type!==N.Ethernet||a?l():l(new Error("请输入端口号"))}}]},H=e=>({0:"未知",1:"运行中",2:"已停止",3:"错误"}[e]||"未知"),$=async()=>{A.value=!0;try{const a=await k();if(Array.isArray(a))try{const e=a.map((e=>{let a;try{a="string"==typeof e.configuration?"null"===e.configuration?{}:JSON.parse(e.configuration):e.configuration||{}}catch(l){a={}}return{id:e.id,name:e.name,type:e.type,protocol:e.protocol,role:e.role||T.Client,configuration:a,enable:e.enable,status:e.status,createTime:e.createTime}}));B.value=e,F.value=a.length}catch(e){p.error("数据转换失败，请检查控制台日志"),B.value=[],F.value=0}else p.warning("API返回数据格式不正确，请检查API响应"),B.value=[],F.value=0}catch(a){p.error("获取通道列表失败: "+(a instanceof Error?a.message:String(a))),B.value=[],F.value=0}finally{A.value=!1}};o(B,(e=>{}),{deep:!0});const K=()=>{z.value="add",q.value=!0,Object.assign(D,{name:"",type:N.Ethernet,protocol:0,configuration:{ipAddress:"",port:"502",connectionType:"TCP",cpuType:"S7-1200",rack:"0",slot:"0"},status:1,role:T.Client})},L=async()=>{J.value&&await J.value.validate((async e=>{if(e)try{const e={...D};if("add"===z.value)await w(e);else{const e={...D.configuration};D.type===N.Ethernet&&(e.port=e.port.toString());const a={id:D.id,name:D.name,type:D.type,protocol:D.protocol,role:D.role,configuration:e,enable:D.enable};await E(D.id,a)}p.success("add"===z.value?"新增成功":"更新成功"),q.value=!1,$()}catch(a){p.error("保存失败")}}))},Q=e=>{j.value=e,$()},W=e=>{x.value=e,$()};return o((()=>D.type),(e=>{e===N.Serial?D.configuration={portName:"",baudRate:"9600",dataBits:"8",stopBits:"1",parity:"None"}:e===N.Ethernet&&(D.configuration={ipAddress:"",port:"502",connectionType:"TCP",...D.protocol===C.SiemensS7?{cpuType:"S7-1200"}:{}})})),o((()=>D.protocol),(e=>{D.type===N.Ethernet&&(e===C.SiemensS7?(D.configuration.cpuType="S7-1200",D.configuration.port="102"):e===C.ModbusTCP&&(D.configuration.port="502",delete D.configuration.cpuType))})),t((()=>{$()})),(e,a)=>{const l=d("el-icon"),o=d("el-button"),t=d("el-table-column"),k=d("el-tag"),w=d("el-button-group"),E=d("el-table"),X=d("el-pagination"),Y=d("el-card"),Z=d("el-input"),ee=d("el-form-item"),ae=d("el-option"),le=d("el-select"),oe=d("el-switch"),te=d("el-input-number"),ne=d("el-form"),re=d("el-dialog"),ue=g("loading");return V(),n("div",R,[r("div",O,[a[22]||(a[22]=r("h2",null,"通信通道管理",-1)),u(o,{type:"primary",onClick:K},{default:i((()=>[u(l,null,{default:i((()=>[u(s(f))])),_:1}),a[21]||(a[21]=c("新增通道 "))])),_:1,__:[21]})]),u(Y,{class:"channel-list"},{default:i((()=>[m((V(),b(E,{data:B.value,border:"",onRowClick:a[0]||(a[0]=e=>{})},{default:i((()=>[u(t,{prop:"name",label:"通道名称"}),u(t,{prop:"type",label:"通道类型"},{default:i((({row:e})=>[u(k,{type:""},{default:i((()=>{return[c(v((a=e.type,{[N.Ethernet]:"网口",[N.Serial]:"串口",[N.CAN]:"CAN",[N.PROFINET]:"PROFINET"}[a])),1)];var a})),_:2},1032,["type"])])),_:1}),u(t,{prop:"protocol",label:"协议类型"},{default:i((({row:e})=>[u(k,null,{default:i((()=>{return[c(v((a=e.protocol,{0:"Modbus TCP",1:"Modbus RTU",2:"Siemens S7",3:"Mitsubishi MC",4:"Omron FINS",5:"自定义协议"}[Number(a)]||`未知协议(${a})`)),1)];var a})),_:2},1024)])),_:1}),u(t,{prop:"enable",label:"是否启用"},{default:i((({row:e})=>[u(k,{type:e.enable?"success":"danger"},{default:i((()=>[c(v(e.enable?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),u(t,{prop:"status",label:"状态"},{default:i((({row:e})=>{return[u(k,{type:(a=e.status,{0:"info",1:"success",2:"warning",3:"danger"}[a]||"info")},{default:i((()=>[c(v(H(e.status)),1)])),_:2},1032,["type"])];var a})),_:1}),u(t,{prop:"createTime",label:"创建时间"}),u(t,{label:"操作",width:"280"},{default:i((({row:e})=>[u(w,null,{default:i((()=>[u(o,{type:"primary",link:"",onClick:a=>(async e=>{z.value="edit",q.value=!0;const a=Number(e.protocol);Object.assign(D,{id:e.id,name:e.name,type:e.type,protocol:a,role:e.role||T.Client,enable:e.enable,status:e.status}),D.configuration&&"object"==typeof D.configuration||(D.configuration={});const l="string"==typeof e.configuration?JSON.parse(e.configuration):JSON.parse(JSON.stringify(e.configuration||{}));e.type===N.Serial?Object.assign(D.configuration,{portName:void 0!==l.portName?l.portName:"",baudRate:void 0!==l.baudRate?l.baudRate:"9600",dataBits:void 0!==l.dataBits?l.dataBits:"8",stopBits:void 0!==l.stopBits?l.stopBits:"1",parity:void 0!==l.parity?l.parity:"None"}):e.type===N.Ethernet&&(Object.assign(D.configuration,{ipAddress:void 0!==l.ipAddress?l.ipAddress:"",port:void 0!==l.port?l.port:"502",connectionType:void 0!==l.connectionType?l.connectionType:"TCP"}),a===C.SiemensS7?(D.configuration.cpuType=void 0!==l.cpuType?l.cpuType:"S7-1200",D.configuration.rack=void 0!==l.rack?l.rack:"0",D.configuration.slot=void 0!==l.slot?l.slot:"0",l.port&&"502"!==l.port||(D.configuration.port="102")):("cpuType"in D.configuration&&delete D.configuration.cpuType,"rack"in D.configuration&&delete D.configuration.rack,"slot"in D.configuration&&delete D.configuration.slot)),await h(),J.value&&J.value.clearValidate()})(e)},{default:i((()=>a[23]||(a[23]=[c(" 编辑 ")]))),_:2,__:[23]},1032,["onClick"]),u(o,{type:"primary",link:"",onClick:a=>(async e=>{try{const a=!e.enable;await P(e.id,a),p.success("启用状态更新成功"),$()}catch(a){p.error("更新启用状态失败")}})(e)},{default:i((()=>[c(v(e.enable?"禁用":"启用"),1)])),_:2},1032,["onClick"]),u(o,{type:"danger",link:"",onClick:a=>(e=>{S.confirm("确定要删除该通道吗？","提示",{type:"warning"}).then((async()=>{try{await U(e.id),p.success("删除成功"),$()}catch(a){p.error("删除失败")}}))})(e)},{default:i((()=>a[24]||(a[24]=[c(" 删除 ")]))),_:2,__:[24]},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[ue,A.value]]),r("div",I,[u(X,{"current-page":x.value,"onUpdate:currentPage":a[1]||(a[1]=e=>x.value=e),"page-size":j.value,"onUpdate:pageSize":a[2]||(a[2]=e=>j.value=e),total:F.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])])),_:1}),u(re,{modelValue:q.value,"onUpdate:modelValue":a[20]||(a[20]=e=>q.value=e),title:"add"===z.value?"新增通道":"编辑通道",width:"600px"},{footer:i((()=>[r("span",M,[u(o,{onClick:a[19]||(a[19]=e=>q.value=!1)},{default:i((()=>a[25]||(a[25]=[c("取消")]))),_:1,__:[25]}),u(o,{type:"primary",onClick:L},{default:i((()=>a[26]||(a[26]=[c("确定")]))),_:1,__:[26]})])])),default:i((()=>[u(ne,{ref_key:"formRef",ref:J,model:D,rules:G,"label-width":"100px"},{default:i((()=>[u(ee,{label:"通道名称",prop:"name"},{default:i((()=>[u(Z,{modelValue:D.name,"onUpdate:modelValue":a[3]||(a[3]=e=>D.name=e),placeholder:"请输入通道名称",disabled:"edit"===z.value},null,8,["modelValue","disabled"])])),_:1}),u(ee,{label:"通道类型",prop:"type"},{default:i((()=>[u(le,{modelValue:D.type,"onUpdate:modelValue":a[4]||(a[4]=e=>D.type=e),placeholder:"请选择通道类型",disabled:"edit"===z.value},{default:i((()=>[u(ae,{label:"网口",value:s(N).Ethernet},null,8,["value"]),u(ae,{label:"串口",value:s(N).Serial},null,8,["value"]),u(ae,{label:"CAN",value:s(N).CAN},null,8,["value"]),u(ae,{label:"PROFINET",value:s(N).PROFINET},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1}),u(ee,{label:"协议类型",prop:"protocol"},{default:i((()=>[u(le,{modelValue:D.protocol,"onUpdate:modelValue":a[5]||(a[5]=e=>D.protocol=e),placeholder:"请选择协议类型",disabled:"edit"===z.value},{default:i((()=>[u(ae,{label:"Modbus TCP",value:Number(s(C).ModbusTCP)},null,8,["value"]),u(ae,{label:"Modbus RTU",value:Number(s(C).ModbusRTU)},null,8,["value"]),u(ae,{label:"Siemens S7",value:Number(s(C).SiemensS7)},null,8,["value"]),u(ae,{label:"Mitsubishi MC",value:Number(s(C).MitsubishiMC)},null,8,["value"]),u(ae,{label:"Omron FINS",value:Number(s(C).OmronFINS)},null,8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1}),u(ee,{label:"通道角色",prop:"role"},{default:i((()=>[u(le,{modelValue:D.role,"onUpdate:modelValue":a[6]||(a[6]=e=>D.role=e),placeholder:"请选择通道角色"},{default:i((()=>[u(ae,{label:"客户端",value:s(T).Client},null,8,["value"]),u(ae,{label:"服务器",value:s(T).Server},null,8,["value"])])),_:1},8,["modelValue"])])),_:1}),u(ee,{label:"是否启用",prop:"enable"},{default:i((()=>[u(oe,{modelValue:D.enable,"onUpdate:modelValue":a[7]||(a[7]=e=>D.enable=e),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])])),_:1}),D.type===s(N).Serial?(V(),n(_,{key:0},[u(ee,{label:"串口配置"},{default:i((()=>[u(Z,{modelValue:D.configuration.portName,"onUpdate:modelValue":a[8]||(a[8]=e=>D.configuration.portName=e),placeholder:"请输入串口名称"},null,8,["modelValue"])])),_:1}),u(ee,{label:"波特率"},{default:i((()=>[u(le,{modelValue:D.configuration.baudRate,"onUpdate:modelValue":a[9]||(a[9]=e=>D.configuration.baudRate=e),placeholder:"请选择波特率"},{default:i((()=>[u(ae,{label:"9600",value:"9600"}),u(ae,{label:"19200",value:"19200"}),u(ae,{label:"38400",value:"38400"}),u(ae,{label:"57600",value:"57600"}),u(ae,{label:"115200",value:"115200"})])),_:1},8,["modelValue"])])),_:1}),u(ee,{label:"数据位"},{default:i((()=>[u(le,{modelValue:D.configuration.dataBits,"onUpdate:modelValue":a[10]||(a[10]=e=>D.configuration.dataBits=e),placeholder:"请选择数据位"},{default:i((()=>[u(ae,{label:"7",value:"7"}),u(ae,{label:"8",value:"8"})])),_:1},8,["modelValue"])])),_:1}),u(ee,{label:"停止位"},{default:i((()=>[u(le,{modelValue:D.configuration.stopBits,"onUpdate:modelValue":a[11]||(a[11]=e=>D.configuration.stopBits=e),placeholder:"请选择停止位"},{default:i((()=>[u(ae,{label:"1",value:"1"}),u(ae,{label:"2",value:"2"})])),_:1},8,["modelValue"])])),_:1}),u(ee,{label:"校验位"},{default:i((()=>[u(le,{modelValue:D.configuration.parity,"onUpdate:modelValue":a[12]||(a[12]=e=>D.configuration.parity=e),placeholder:"请选择校验位"},{default:i((()=>[u(ae,{label:"无",value:"None"}),u(ae,{label:"奇校验",value:"Odd"}),u(ae,{label:"偶校验",value:"Even"})])),_:1},8,["modelValue"])])),_:1})],64)):y("",!0),D.type===s(N).Ethernet?(V(),n(_,{key:1},[u(ee,{label:"IP地址",prop:"configuration.ipAddress"},{default:i((()=>[u(Z,{modelValue:D.configuration.ipAddress,"onUpdate:modelValue":a[13]||(a[13]=e=>D.configuration.ipAddress=e),placeholder:"请输入IP地址"},null,8,["modelValue"])])),_:1}),u(ee,{label:"端口",prop:"configuration.port"},{default:i((()=>[u(te,{modelValue:D.configuration.port,"onUpdate:modelValue":a[14]||(a[14]=e=>D.configuration.port=e),min:1,max:65535,controls:!1,placeholder:"请输入端口"},null,8,["modelValue"])])),_:1}),u(ee,{label:"连接类型",prop:"configuration.connectionType"},{default:i((()=>[u(le,{modelValue:D.configuration.connectionType,"onUpdate:modelValue":a[15]||(a[15]=e=>D.configuration.connectionType=e),placeholder:"请选择连接类型"},{default:i((()=>[u(ae,{label:"TCP",value:"TCP"}),u(ae,{label:"UDP",value:"UDP"})])),_:1},8,["modelValue"])])),_:1}),D.protocol===s(C).SiemensS7?(V(),n(_,{key:0},[u(ee,{label:"CPU类型",prop:"configuration.cpuType"},{default:i((()=>[u(le,{modelValue:D.configuration.cpuType,"onUpdate:modelValue":a[16]||(a[16]=e=>D.configuration.cpuType=e),placeholder:"请选择CPU类型"},{default:i((()=>[u(ae,{label:"S7-200Smart",value:"S7-200Smart"}),u(ae,{label:"S7-200",value:"S7-200"}),u(ae,{label:"S7-300",value:"S7-300"}),u(ae,{label:"S7-400",value:"S7-400"}),u(ae,{label:"S7-1200",value:"S7-1200"}),u(ae,{label:"S7-1500",value:"S7-1500"})])),_:1},8,["modelValue"])])),_:1}),u(ee,{label:"Rack",prop:"configuration.rack"},{default:i((()=>[u(te,{modelValue:D.configuration.rack,"onUpdate:modelValue":a[17]||(a[17]=e=>D.configuration.rack=e),min:0,max:255,controls:!1,placeholder:"请输入Rack (默认0)"},null,8,["modelValue"])])),_:1}),u(ee,{label:"Slot",prop:"configuration.slot"},{default:i((()=>[u(te,{modelValue:D.configuration.slot,"onUpdate:modelValue":a[18]||(a[18]=e=>D.configuration.slot=e),min:0,max:255,controls:!1,placeholder:"请输入Slot (默认0)"},null,8,["modelValue"])])),_:1})],64)):y("",!0)],64)):y("",!0)])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-da1c0dfa"]]);export{B as default};
