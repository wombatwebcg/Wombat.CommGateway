import{d as e,r as a,a as l,o as n,c as d,b as r,e as t,w as i,g as o,E as u,n as s,k as c,G as p,I as m,q as v,L as f,M as h,t as _,N as g,O as y,P as b,x as k,H as w,F as N,z as C,D as V,j as G}from"./index-BKaj1bP9.js";import{g as I,u as x,d as j,c as U,a as z}from"./device-DjQUr6tV.js";import{g as q,C as A}from"./channel-CBszU6Kb.js";import{g as F,c as O,u as S,d as R}from"./deviceGroup-CStYvMxJ.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";const $={class:"devices-container"},D={class:"page-header"},E={class:"main-content"},H={class:"device-group-tree"},L={class:"tree-header"},M={class:"custom-tree-node"},B={class:"node-content"},J={key:0,class:"node-actions"},K={class:"device-list"},Q={class:"operation-buttons"},T={class:"pagination"},W={style:{display:"flex","align-items":"center","justify-content":"space-between"}},X={class:"dialog-footer"},Y={class:"dialog-footer"},Z=P(e({__name:"index",setup(e){const P=a([]),Z=a(null),ee=a(),ae={children:"children",label:"name"},le=a(!1),ne=a("add"),de=a(),re=l({id:void 0,name:"",description:""}),te={name:[{required:!0,message:"请输入设备组名称",trigger:"blur"}]},ie=a(!1),oe=a([]),ue=a(1),se=a(10),ce=a(0),pe=a(!1),me=a("add"),ve=a(),fe=a([]),he=l({id:void 0,name:"",description:"",deviceGroupId:void 0,deviceGroupName:"",channelId:void 0,channelName:""}),_e={name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],channelName:[{required:!0,message:"请选择通道名称",trigger:"change"}],deviceGroupId:[{required:!0,message:"请选择设备组",trigger:"change"}],description:[{required:!0,message:"请输入设备描述",trigger:"blur"}]},ge=async()=>{try{const e=await F();P.value=[{id:0,name:"全部",description:"所有设备",children:Array.isArray(e)?[...e]:[]}]}catch(e){u.error("获取设备组列表失败")}},ye=()=>{ne.value="add",le.value=!0,de.value&&de.value.resetFields(),Object.assign(re,{id:void 0,name:"",description:""})},be=async()=>{if(de.value)try{await de.value.validate();const e={name:re.name.trim(),description:re.description.trim()};"add"===ne.value?(await O(e),u.success("新增成功")):(await S(re.id,e),u.success("更新成功")),le.value=!1,await ge()}catch(e){(null==e?void 0:e.message)?u.error(e.message):u.error("操作失败，请重试")}},ke=e=>{Z.value=e.id,we()},we=async()=>{ie.value=!0;try{const e=await I();let a=Array.isArray(e)?[...e]:[];Z.value&&0!==Z.value&&(a=a.filter((e=>e.deviceGroupId===Z.value))),oe.value=a,ce.value=a.length}catch(e){u.error("获取设备列表失败")}finally{ie.value=!1}},Ne=()=>{me.value="add",pe.value=!0,ve.value&&ve.value.resetFields(),Object.assign(he,{id:void 0,name:"",description:"",deviceGroupId:void 0,deviceGroupName:"",channelId:void 0,channelName:""})},Ce=async()=>{if(ve.value)try{await ve.value.validate();const e={name:he.name.trim(),description:he.description.trim(),deviceGroupId:he.deviceGroupId,deviceGroupName:he.deviceGroupName,channelId:he.channelId,channelName:he.channelName};"add"===me.value?(await U(e),u.success("新增成功")):(await z(he.id,e),u.success("更新成功")),pe.value=!1,await we()}catch(e){(null==e?void 0:e.message)?u.error(e.message):u.error("操作失败，请重试")}},Ve=e=>{se.value=e,we()},Ge=e=>{ue.value=e,we()},Ie=e=>{var a;const l=null==(a=P.value[0].children)?void 0:a.find((a=>a.id===e));l&&(he.deviceGroupId=l.id,he.deviceGroupName=l.name)},xe=e=>{const a=fe.value.find((a=>a.name===e));a&&(he.channelId=a.id,he.channelName=a.name)};n((()=>{we(),(async()=>{try{const e=await q();Array.isArray(e)?fe.value=e.map((e=>({...e,role:e.role||A.Client}))):fe.value=[]}catch(e){u.error("获取通道列表失败")}})(),ge()}));const je=e=>{const a=fe.value.find((a=>a.name===e));return null==a?void 0:a.role},Ue=e=>{switch(e){case A.Client:return"primary";case A.Server:return"success";default:return"info"}},ze=e=>{switch(e){case A.Client:return"客户端";case A.Server:return"服务器";default:return"未知"}};return(e,a)=>{const l=o("el-icon"),n=o("el-button"),I=o("el-tree"),U=o("el-card"),z=o("el-table-column"),q=o("el-tag"),A=o("el-button-group"),F=o("el-table"),O=o("el-pagination"),S=o("el-input"),Z=o("el-form-item"),qe=o("el-option"),Ae=o("el-select"),Fe=o("el-form"),Oe=o("el-dialog"),Se=w("loading");return G(),d("div",$,[r("div",D,[a[13]||(a[13]=r("h2",null,"设备管理",-1)),t(n,{type:"primary",onClick:Ne},{default:i((()=>[t(l,null,{default:i((()=>[t(c(p))])),_:1}),a[12]||(a[12]=s("新增设备 "))])),_:1,__:[12]})]),r("div",E,[r("div",H,[t(U,{class:"tree-card"},{header:i((()=>[r("div",L,[a[14]||(a[14]=r("span",null,"设备组",-1)),t(n,{type:"primary",link:"",onClick:ye},{default:i((()=>[t(l,null,{default:i((()=>[t(c(p))])),_:1})])),_:1})])])),default:i((()=>[t(I,{ref_key:"treeRef",ref:ee,data:P.value,props:ae,"node-key":"id","default-expand-all":"","highlight-current":"",onNodeClick:ke},{default:i((({node:e,data:a})=>[r("div",M,[r("div",B,[0===a.id?(G(),v(l,{key:0,class:"node-icon root-icon"},{default:i((()=>[t(c(f))])),_:1})):(G(),v(l,{key:1,class:"node-icon group-icon"},{default:i((()=>[t(c(h))])),_:1})),r("span",null,_(e.label),1)]),0!==a.id?(G(),d("span",J,[t(n,{type:"primary",link:"",onClick:g((e=>{return l=a,ne.value="edit",le.value=!0,de.value&&de.value.resetFields(),void Object.assign(re,{...l});var l}),["stop"])},{default:i((()=>[t(l,null,{default:i((()=>[t(c(y))])),_:1})])),_:2},1032,["onClick"]),t(n,{type:"danger",link:"",onClick:g((e=>{return l=a,void V.confirm("确定要删除该设备组吗？","提示",{type:"warning"}).then((async()=>{try{await R(l.id),u.success("删除成功"),ge()}catch(e){u.error("删除失败")}}));var l}),["stop"])},{default:i((()=>[t(l,null,{default:i((()=>[t(c(b))])),_:1})])),_:2},1032,["onClick"])])):m("",!0)])])),_:1},8,["data"])])),_:1})]),r("div",K,[t(U,null,{default:i((()=>[k((G(),v(F,{data:oe.value,border:""},{default:i((()=>[t(z,{prop:"name",label:"设备名称"}),t(z,{prop:"channelName",label:"通道名称"},{default:i((({row:e})=>[r("span",null,_(e.channelName),1),void 0!==je(e.channelName)?(G(),v(q,{key:0,type:Ue(je(e.channelName)),size:"small",class:"ml-2"},{default:i((()=>[s(_(ze(je(e.channelName))),1)])),_:2},1032,["type"])):m("",!0)])),_:1}),t(z,{prop:"deviceGroupName",label:"设备组名称"}),t(z,{prop:"description",label:"描述"}),t(z,{prop:"enable",label:"是否启用"},{default:i((({row:e})=>[t(q,{type:e.enable?"success":"danger"},{default:i((()=>[s(_(e.enable?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),t(z,{label:"操作",width:"280"},{default:i((({row:e})=>[r("div",Q,[t(A,null,{default:i((()=>[t(n,{type:"primary",link:"",onClick:a=>(e=>{var a;me.value="edit",pe.value=!0,ve.value&&ve.value.resetFields();const l=null==(a=P.value[0].children)?void 0:a.find((a=>a.name===e.deviceGroupName)),n=fe.value.find((a=>a.name===e.channelName));Object.assign(he,{...e,deviceGroupId:null==l?void 0:l.id,deviceGroupName:e.deviceGroupName,channelId:null==n?void 0:n.id,channelName:e.channelName})})(e)},{default:i((()=>a[15]||(a[15]=[s(" 编辑 ")]))),_:2,__:[15]},1032,["onClick"]),t(n,{type:"primary",link:"",onClick:a=>(async e=>{try{await x(e.id,!e.enable),u.success((e.enable?"禁用":"启用")+"成功"),we()}catch(a){u.error("更新启用状态失败")}})(e)},{default:i((()=>[s(_(e.enable?"禁用":"启用"),1)])),_:2},1032,["onClick"]),t(n,{type:"danger",link:"",onClick:a=>(e=>{V.confirm("确定要删除该设备吗？","提示",{type:"warning"}).then((async()=>{try{await j(e.id),u.success("删除成功"),we()}catch(a){u.error("删除失败")}}))})(e)},{default:i((()=>a[16]||(a[16]=[s(" 删除 ")]))),_:2,__:[16]},1032,["onClick"])])),_:2},1024)])])),_:1})])),_:1},8,["data"])),[[Se,ie.value]]),r("div",T,[t(O,{"current-page":ue.value,"onUpdate:currentPage":a[0]||(a[0]=e=>ue.value=e),"page-size":se.value,"onUpdate:pageSize":a[1]||(a[1]=e=>se.value=e),total:ce.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:Ve,onCurrentChange:Ge},null,8,["current-page","page-size","total"])])])),_:1})])]),t(Oe,{modelValue:pe.value,"onUpdate:modelValue":a[7]||(a[7]=e=>pe.value=e),title:"add"===me.value?"新增设备":"编辑设备",width:"600px"},{footer:i((()=>[r("span",X,[t(n,{onClick:a[6]||(a[6]=e=>pe.value=!1)},{default:i((()=>a[17]||(a[17]=[s("取消")]))),_:1,__:[17]}),t(n,{type:"primary",onClick:Ce},{default:i((()=>a[18]||(a[18]=[s("确定")]))),_:1,__:[18]})])])),default:i((()=>[t(Fe,{ref_key:"formRef",ref:ve,model:he,rules:_e,"label-width":"100px"},{default:i((()=>[t(Z,{label:"设备名称",prop:"name"},{default:i((()=>[t(S,{modelValue:he.name,"onUpdate:modelValue":a[2]||(a[2]=e=>he.name=e),placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),t(Z,{label:"通道名称",prop:"channelName"},{default:i((()=>[t(Ae,{modelValue:he.channelName,"onUpdate:modelValue":a[3]||(a[3]=e=>he.channelName=e),placeholder:"请选择通道名称",onChange:xe},{default:i((()=>[(G(!0),d(N,null,C(fe.value,(e=>(G(),v(qe,{key:e.name,label:`${e.name} ${ze(e.role)}`,value:e.name},{default:i((()=>[r("div",W,[r("span",null,_(e.name),1),t(q,{type:Ue(e.role),size:"small"},{default:i((()=>[s(_(ze(e.role)),1)])),_:2},1032,["type"])])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),t(Z,{label:"设备组",prop:"deviceGroupId"},{default:i((()=>[t(Ae,{modelValue:he.deviceGroupId,"onUpdate:modelValue":a[4]||(a[4]=e=>he.deviceGroupId=e),placeholder:"请选择设备组",onChange:Ie},{default:i((()=>{return[(G(!0),d(N,null,C((null==(e=P.value[0])?void 0:e.children)||[],(e=>(G(),v(qe,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))];var e})),_:1},8,["modelValue"])])),_:1}),t(Z,{label:"描述",prop:"description"},{default:i((()=>[t(S,{modelValue:he.description,"onUpdate:modelValue":a[5]||(a[5]=e=>he.description=e),type:"textarea",placeholder:"请输入设备描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"]),t(Oe,{modelValue:le.value,"onUpdate:modelValue":a[11]||(a[11]=e=>le.value=e),title:"add"===ne.value?"新增设备组":"编辑设备组",width:"500px"},{footer:i((()=>[r("span",Y,[t(n,{onClick:a[10]||(a[10]=e=>le.value=!1)},{default:i((()=>a[19]||(a[19]=[s("取消")]))),_:1,__:[19]}),t(n,{type:"primary",onClick:be},{default:i((()=>a[20]||(a[20]=[s("确定")]))),_:1,__:[20]})])])),default:i((()=>[t(Fe,{ref_key:"groupFormRef",ref:de,model:re,rules:te,"label-width":"100px"},{default:i((()=>[t(Z,{label:"组名称",prop:"name"},{default:i((()=>[t(S,{modelValue:re.name,"onUpdate:modelValue":a[8]||(a[8]=e=>re.name=e),placeholder:"请输入设备组名称"},null,8,["modelValue"])])),_:1}),t(Z,{label:"描述",prop:"description"},{default:i((()=>[t(S,{modelValue:re.description,"onUpdate:modelValue":a[9]||(a[9]=e=>re.description=e),type:"textarea",placeholder:"请输入设备组描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-1d87ee2d"]]);export{Z as default};
