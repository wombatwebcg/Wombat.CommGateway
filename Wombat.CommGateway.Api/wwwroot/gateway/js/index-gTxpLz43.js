import{s as e,X as a,r as l,d as t,Y as o,a as r,o as u,c as n,b as d,x as i,e as s,w as c,g as p,H as m,k as v,q as y,n as f,t as b,F as _,z as h,E as g,D as w,j as k}from"./index-BKaj1bP9.js";import{_ as C}from"./_plugin-vue_export-helper-BCo6x5W8.js";const V=a("protocol",(()=>{const a=l([]),t=l(null),o=l(!1);return{protocolList:a,currentProtocol:t,loading:o,fetchProtocolList:async()=>{try{o.value=!0;const l=await e({url:"/api/ProtocolConfig",method:"get"});a.value=l}finally{o.value=!1}},fetchProtocolById:async a=>{try{o.value=!0;const l=await(a=>e({url:`/api/ProtocolConfig/${a}`,method:"get"}))(a);t.value=l}finally{o.value=!1}},createProtocol:async l=>{try{o.value=!0;const t=await(a=>e({url:"/api/ProtocolConfig",method:"post",data:a}))(l);return a.value.push(t),t}finally{o.value=!1}},updateProtocol:async(l,r)=>{var u;try{o.value=!0;const n=await((a,l)=>e({url:`/api/ProtocolConfig/${a}`,method:"put",data:l}))(l,r),d=a.value.findIndex((e=>e.id===l));return-1!==d&&(a.value[d]=n),(null==(u=t.value)?void 0:u.id)===l&&(t.value=n),n}finally{o.value=!1}},removeProtocol:async l=>{var r;try{o.value=!0,await(a=>e({url:`/api/ProtocolConfig/${a}`,method:"delete"}))(l),a.value=a.value.filter((e=>e.id!==l)),(null==(r=t.value)?void 0:r.id)===l&&(t.value=null)}finally{o.value=!1}},updateStatus:async(l,r)=>{var u;try{o.value=!0;const n=await((a,l)=>e({url:`/api/ProtocolConfig/${a}/status`,method:"patch",params:{enabled:l}}))(l,r),d=a.value.findIndex((e=>e.id===l));return-1!==d&&(a.value[d]=n),(null==(u=t.value)?void 0:u.id)===l&&(t.value=n),n}finally{o.value=!1}}}})),P={class:"protocol-config"},x={class:"header"},U=C(t({__name:"index",setup(e){const a=V(),{protocolList:t,loading:C,currentProtocol:U}=o(a),j=l(!1),M=l("create"),S=l(),I=r({name:"",type:"",version:"",parameters:{}}),O=l({}),$={name:[{required:!0,message:"请输入协议名称",trigger:"blur"}],type:[{required:!0,message:"请选择协议类型",trigger:"change"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"}]};u((()=>{a.fetchProtocolList()}));const q=()=>{M.value="create",I.name="",I.type="",I.version="",I.parameters={},Object.keys(O.value).forEach((e=>delete O.value[e])),j.value=!0},E=()=>{const e=`param_${Date.now()}`;I.parameters[e]="",O.value[e]=""},L=async()=>{S.value&&await S.value.validate((async e=>{if(e)try{const e=Object.keys(I.parameters).reduce(((e,a)=>(e[O.value[a]||a]=I.parameters[a],e)),{});"create"===M.value?(await a.createProtocol({name:I.name,type:I.type,version:I.version,parameters:e}),g.success("创建成功")):U.value&&(await a.updateProtocol(U.value.id,{name:I.name,type:I.type,version:I.version,parameters:e,enabled:U.value.enabled}),g.success("更新成功")),j.value=!1}catch(l){g.error("操作失败")}}))};return(e,l)=>{const o=p("el-button"),r=p("el-table-column"),u=p("el-tag"),V=p("el-button-group"),U=p("el-table"),T=p("el-input"),F=p("el-form-item"),R=p("el-option"),D=p("el-select"),z=p("el-form"),B=p("el-dialog"),H=m("loading");return k(),n("div",P,[d("div",x,[l[6]||(l[6]=d("h2",null,"协议配置",-1)),s(o,{type:"primary",onClick:q},{default:c((()=>l[5]||(l[5]=[f("新建协议")]))),_:1,__:[5]})]),i((k(),y(U,{data:v(t),style:{width:"100%"},border:""},{default:c((()=>[s(r,{prop:"name",label:"协议名称","min-width":"120"}),s(r,{prop:"type",label:"协议类型","min-width":"120"}),s(r,{prop:"version",label:"版本","min-width":"100"}),s(r,{prop:"enabled",label:"状态",width:"100"},{default:c((({row:e})=>[s(u,{type:e.enabled?"success":"danger"},{default:c((()=>[f(b(e.enabled?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),s(r,{prop:"createTime",label:"创建时间","min-width":"160"}),s(r,{label:"操作",width:"200",fixed:"right"},{default:c((({row:e})=>[s(V,null,{default:c((()=>[s(o,{type:"primary",link:"",onClick:a=>(e=>{M.value="edit",I.name=e.name,I.type=e.type,I.version=e.version,I.parameters={...e.parameters},Object.keys(O.value).forEach((e=>delete O.value[e])),Object.keys(e.parameters).forEach((e=>{O.value[e]=e})),j.value=!0})(e)},{default:c((()=>l[7]||(l[7]=[f("编辑")]))),_:2,__:[7]},1032,["onClick"]),s(o,{type:"primary",link:"",onClick:l=>(async e=>{try{await a.updateStatus(e.id,!e.enabled),g.success((e.enabled?"禁用":"启用")+"成功")}catch(l){g.error("操作失败")}})(e)},{default:c((()=>[f(b(e.enabled?"禁用":"启用"),1)])),_:2},1032,["onClick"]),s(o,{type:"danger",link:"",onClick:l=>(async e=>{try{await w.confirm("确定要删除该协议配置吗？","提示",{type:"warning"}),await a.removeProtocol(e.id),g.success("删除成功")}catch(l){"cancel"!==l&&g.error("删除失败")}})(e)},{default:c((()=>l[8]||(l[8]=[f("删除")]))),_:2,__:[8]},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[H,v(C)]]),s(B,{modelValue:j.value,"onUpdate:modelValue":l[4]||(l[4]=e=>j.value=e),title:"create"===M.value?"新建协议":"编辑协议",width:"600px"},{footer:c((()=>[s(o,{onClick:l[3]||(l[3]=e=>j.value=!1)},{default:c((()=>l[11]||(l[11]=[f("取消")]))),_:1,__:[11]}),s(o,{type:"primary",onClick:L},{default:c((()=>l[12]||(l[12]=[f("确定")]))),_:1,__:[12]})])),default:c((()=>[s(z,{ref_key:"formRef",ref:S,model:I,rules:$,"label-width":"100px"},{default:c((()=>[s(F,{label:"协议名称",prop:"name"},{default:c((()=>[s(T,{modelValue:I.name,"onUpdate:modelValue":l[0]||(l[0]=e=>I.name=e),placeholder:"请输入协议名称"},null,8,["modelValue"])])),_:1}),s(F,{label:"协议类型",prop:"type"},{default:c((()=>[s(D,{modelValue:I.type,"onUpdate:modelValue":l[1]||(l[1]=e=>I.type=e),placeholder:"请选择协议类型",style:{width:"100%"}},{default:c((()=>[s(R,{label:"Modbus TCP",value:"ModbusTcp"}),s(R,{label:"Modbus RTU",value:"ModbusRtu"}),s(R,{label:"西门子 S7",value:"SiemensS7"}),s(R,{label:"三菱 MC",value:"MitsubishiMc"}),s(R,{label:"欧姆龙 FINS",value:"OmronFins"})])),_:1},8,["modelValue"])])),_:1}),s(F,{label:"版本",prop:"version"},{default:c((()=>[s(T,{modelValue:I.version,"onUpdate:modelValue":l[2]||(l[2]=e=>I.version=e),placeholder:"请输入版本号"},null,8,["modelValue"])])),_:1}),s(F,{label:"参数配置"},{default:c((()=>[s(o,{type:"primary",link:"",onClick:E},{default:c((()=>l[9]||(l[9]=[f("添加参数")]))),_:1,__:[9]}),(k(!0),n(_,null,h(I.parameters,((e,a)=>(k(),n("div",{key:a,class:"parameter-item"},[s(T,{modelValue:O.value[a],"onUpdate:modelValue":e=>O.value[a]=e,placeholder:"参数名",style:{width:"200px"}},null,8,["modelValue","onUpdate:modelValue"]),s(T,{modelValue:I.parameters[a],"onUpdate:modelValue":e=>I.parameters[a]=e,placeholder:"参数值",style:{width:"300px"}},null,8,["modelValue","onUpdate:modelValue"]),s(o,{type:"danger",link:"",onClick:e=>(e=>{delete I.parameters[e],delete O.value[e]})(a)},{default:c((()=>l[10]||(l[10]=[f("删除")]))),_:2,__:[10]},1032,["onClick"])])))),128))])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-d93cb958"]]);export{U as default};
